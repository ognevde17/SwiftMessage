# Интеграционные тесты для проекта SwiftMessage

## Обзор тестов

В этой директории находятся интеграционные тесты для проекта SwiftMessage. В отличие от модульных тестов, интеграционные тесты проверяют взаимодействие между различными компонентами системы в реальном сценарии использования.

Основной тест (`full_scenario_test.cpp`) реализует следующий сценарий:
1. Запуск сервера
2. Создание двух клиентов
3. Регистрация обоих клиентов в системе
4. Авторизация обоих клиентов
5. Отправка сообщения от первого клиента ко второму
6. Проверка получения сообщения вторым клиентом
7. Проверка содержимого полученного сообщения

## Технические особенности

Для реализации интеграционных тестов используются следующие подходы:
- Сервер запускается в отдельном потоке
- Каждый клиент работает в своем потоке
- Используются мьютексы и условные переменные для синхронизации между потоками
- Случайные порты для тестирования, чтобы избежать конфликтов при параллельном запуске

## Требования для запуска

Для успешного запуска интеграционных тестов необходимо:
1. PostgreSQL сервер с настроенной базой данных `swiftmessage`
2. Пользователь PostgreSQL с именем `postgres` и паролем `postgres` (или изменить эти параметры в коде теста)
3. В базе данных должны быть созданы необходимые таблицы (см. документацию по настройке сервера)

## Запуск тестов

### Настройка и компиляция

```bash
cd build
cmake .. -DBUILD_INTEGRATION_TESTS=ON
make
```

### Запуск

```bash
cd build
./integration_tests/full_scenario_test
```

## Возможные проблемы

1. **Ошибки подключения к базе данных**: Убедитесь, что PostgreSQL сервер запущен и база данных swiftmessage существует
2. **Ошибки доступа к порту**: Если тест не может связаться с сервером, возможно, порт занят другим процессом
3. **Тайм-ауты**: При медленном соединении может потребоваться увеличить время ожидания в тестах

## Расширение тестов

Для добавления новых интеграционных тестов:
1. Создайте новый cpp-файл в директории integration_tests
2. Добавьте его в CMakeLists.txt
3. При необходимости создайте дополнительные вспомогательные классы для работы с новыми сценариями 